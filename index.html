<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="/" />
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Leak Memory Vue</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <script src="https://unpkg.com/vuex@2.0.0"></script>
  </head>
  <body>
    <div id="app"></div>
  </body>
  <script>
    const data = `[{"_id":"5e2362dd3ac80e1268cd84f1","class":"map","serverName":"server_1","id":834,"type":1,"x":27,"y":24,"region":[[{"id":0,"x":0,"y":0,"type":0,"army":[{"race":"rampart","name":"dendroid","lvl":5,"count":10,"up":0},{"race":"rampart","name":"pegas","lvl":4,"count":9,"up":0},{"race":"rampart","name":"green_dragon","lvl":7,"count":7,"up":0},{"race":"rampart","name":"green_dragon_2","lvl":7,"count":5,"up":1}]},{"id":1,"x":0,"y":1,"type":0,"army":[{"race":"rampart","name":"pegas","lvl":4,"count":4,"up":0},{"race":"rampart","name":"pegas_2","lvl":4,"count":8,"up":1},{"race":"rampart","name":"dendroid_2","lvl":5,"count":5,"up":1},{"race":"rampart","name":"green_dragon_2","lvl":7,"count":9,"up":1},{"race":"rampart","name":"elf","lvl":3,"count":4,"up":0},{"race":"rampart","name":"green_dragon","lvl":7,"count":2,"up":0}]},{"id":2,"x":0,"y":2,"type":0,"army":[{"race":"rampart","name":"elf","lvl":3,"count":27,"up":0},{"race":"rampart","name":"gnom_2","lvl":2,"count":20,"up":1}]},{"id":3,"x":0,"y":3,"type":0,"army":[{"race":"rampart","name":"kentavr_2","lvl":1,"count":43,"up":1},{"race":"rampart","name":"kentavr","lvl":1,"count":33,"up":0},{"race":"rampart","name":"elf_2","lvl":3,"count":15,"up":1}]},{"id":4,"x":0,"y":4,"type":0,"army":[{"race":"rampart","name":"gnom","lvl":2,"count":14,"up":0},{"race":"rampart","name":"gnom_2","lvl":2,"count":19,"up":1},{"race":"rampart","name":"pegas","lvl":4,"count":23,"up":0}]}],[{"id":5,"x":1,"y":0,"type":0,"army":[{"race":"rampart","name":"pegas_2","lvl":4,"count":3,"up":1},{"race":"rampart","name":"green_dragon","lvl":7,"count":6,"up":0},{"race":"rampart","name":"unicorn_2","lvl":6,"count":7,"up":1},{"race":"rampart","name":"gnom","lvl":2,"count":2,"up":0},{"race":"rampart","name":"gnom_2","lvl":2,"count":2,"up":1}]},{"id":6,"x":1,"y":1,"type":2,"army":[{"race":"rampart","name":"dendroid_2","lvl":5,"count":34,"up":1}],"sector":{"parent":"region","class":"mine","type":"gold","lvl":9,"x":1,"y":1,"upgrade":{"is":false,"date":0,"bonus":0},"work":{"is":false,"date":0,"bonus":0,"addValue":18000}}},{"id":7,"x":1,"y":2,"type":0,"army":[{"race":"rampart","name":"pegas","lvl":4,"count":39,"up":0}]},{"id":8,"x":1,"y":3,"type":2,"army":[{"race":"rampart","name":"dendroid_2","lvl":5,"count":8,"up":1},{"race":"rampart","name":"dendroid","lvl":5,"count":5,"up":0},{"race":"rampart","name":"gnom","lvl":2,"count":6,"up":0},{"race":"rampart","name":"pegas","lvl":4,"count":3,"up":0},{"race":"rampart","name":"pegas_2","lvl":4,"count":7,"up":1},{"race":"rampart","name":"unicorn","lvl":6,"count":4,"up":0},{"race":"rampart","name":"gnom_2","lvl":2,"count":5,"up":1}],"sector":{"parent":"region","class":"mine","type":"crystal","lvl":5,"x":1,"y":3,"upgrade":{"is":false,"date":0,"bonus":0},"work":{"is":false,"date":0,"bonus":0,"addValue":5}}},{"id":9,"x":1,"y":4,"type":0,"army":[{"race":"rampart","name":"kentavr","lvl":1,"count":5,"up":0},{"race":"rampart","name":"unicorn","lvl":6,"count":4,"up":0},{"race":"rampart","name":"gnom","lvl":2,"count":5,"up":0},{"race":"rampart","name":"elf","lvl":3,"count":7,"up":0},{"race":"rampart","name":"pegas_2","lvl":4,"count":5,"up":1},{"race":"rampart","name":"gnom_2","lvl":2,"count":5,"up":1},{"race":"rampart","name":"green_dragon_2","lvl":7,"count":7,"up":1}]}],[{"id":10,"x":2,"y":0,"type":2,"army":[{"race":"rampart","name":"gnom_2","lvl":2,"count":4,"up":1},{"race":"rampart","name":"dendroid","lvl":5,"count":5,"up":0},{"race":"rampart","name":"elf","lvl":3,"count":11,"up":0},{"race":"rampart","name":"unicorn_2","lvl":6,"count":5,"up":1},{"race":"rampart","name":"pegas_2","lvl":4,"count":2,"up":1},{"race":"rampart","name":"kentavr_2","lvl":1,"count":3,"up":1}],"sector":{"parent":"region","class":"mine","type":"sulfur","lvl":5,"x":2,"y":0,"upgrade":{"is":false,"date":0,"bonus":0},"work":{"is":false,"date":0,"bonus":0,"addValue":5}}},{"id":11,"x":2,"y":1,"type":0,"army":[{"race":"rampart","name":"elf","lvl":3,"count":18,"up":0},{"race":"rampart","name":"unicorn_2","lvl":6,"count":18,"up":1}]},{"id":12,"x":2,"y":2,"type":1,"army":[{"race":"rampart","name":"kentavr_2","lvl":1,"count":13,"up":1},{"race":"rampart","name":"green_dragon","lvl":7,"count":8,"up":0},{"race":"rampart","name":"dendroid","lvl":5,"count":7,"up":0},{"race":"rampart","name":"gnom","lvl":2,"count":7,"up":0}]},{"id":13,"x":2,"y":3,"type":0,"army":[{"race":"rampart","name":"green_dragon","lvl":7,"count":5,"up":0},{"race":"rampart","name":"pegas","lvl":4,"count":8,"up":0},{"race":"rampart","name":"dendroid","lvl":5,"count":7,"up":0},{"race":"rampart","name":"kentavr_2","lvl":1,"count":6,"up":1}]},{"id":14,"x":2,"y":4,"type":2,"army":[{"race":"rampart","name":"green_dragon","lvl":7,"count":7,"up":0},{"race":"rampart","name":"kentavr","lvl":1,"count":13,"up":0},{"race":"rampart","name":"gnom","lvl":2,"count":12,"up":0},{"race":"rampart","name":"pegas","lvl":4,"count":7,"up":0},{"race":"rampart","name":"elf","lvl":3,"count":8,"up":0},{"race":"rampart","name":"dendroid","lvl":5,"count":8,"up":0}],"sector":{"parent":"region","class":"mine","type":"gem","lvl":5,"x":2,"y":4,"upgrade":{"is":false,"date":0,"bonus":0},"work":{"is":false,"date":0,"bonus":0,"addValue":5}}}],[{"id":15,"x":3,"y":0,"type":0,"army":[{"race":"rampart","name":"kentavr","lvl":1,"count":12,"up":0},{"race":"rampart","name":"green_dragon_2","lvl":7,"count":6,"up":1},{"race":"rampart","name":"unicorn_2","lvl":6,"count":8,"up":1},{"race":"rampart","name":"gnom","lvl":2,"count":9,"up":0},{"race":"rampart","name":"gnom_2","lvl":2,"count":11,"up":1},{"race":"rampart","name":"elf","lvl":3,"count":6,"up":0}]},{"id":16,"x":3,"y":1,"type":2,"army":[{"race":"rampart","name":"gnom","lvl":2,"count":7,"up":0},{"race":"rampart","name":"pegas","lvl":4,"count":7,"up":0},{"race":"rampart","name":"green_dragon_2","lvl":7,"count":8,"up":1},{"race":"rampart","name":"elf_2","lvl":3,"count":4,"up":1},{"race":"rampart","name":"unicorn_2","lvl":6,"count":8,"up":1},{"race":"rampart","name":"elf","lvl":3,"count":6,"up":0}],"sector":{"parent":"region","class":"mine","type":"wood","lvl":7,"x":3,"y":1,"upgrade":{"is":false,"date":0,"bonus":0},"work":{"is":false,"date":0,"bonus":0,"addValue":14}}},{"id":17,"x":3,"y":2,"type":0,"army":[{"race":"rampart","name":"pegas_2","lvl":4,"count":3,"up":1},{"race":"rampart","name":"green_dragon_2","lvl":7,"count":9,"up":1},{"race":"rampart","name":"dendroid","lvl":5,"count":6,"up":0}]},{"id":18,"x":3,"y":3,"type":2,"army":[{"race":"rampart","name":"elf_2","lvl":3,"count":40,"up":1}],"sector":{"parent":"region","class":"mine","type":"ore","lvl":7,"x":3,"y":3,"upgrade":{"is":false,"date":0,"bonus":0},"work":{"is":false,"date":0,"bonus":0,"addValue":14}}},{"id":19,"x":3,"y":4,"type":0,"army":[{"race":"rampart","name":"pegas","lvl":4,"count":7,"up":0},{"race":"rampart","name":"elf","lvl":3,"count":11,"up":0},{"race":"rampart","name":"pegas_2","lvl":4,"count":9,"up":1},{"race":"rampart","name":"gnom","lvl":2,"count":10,"up":0},{"race":"rampart","name":"gnom_2","lvl":2,"count":15,"up":1}]}],[{"id":20,"x":4,"y":0,"type":0,"army":[{"race":"rampart","name":"kentavr_2","lvl":1,"count":8,"up":1},{"race":"rampart","name":"kentavr","lvl":1,"count":6,"up":0},{"race":"rampart","name":"pegas","lvl":4,"count":5,"up":0},{"race":"rampart","name":"elf","lvl":3,"count":8,"up":0},{"race":"rampart","name":"green_dragon","lvl":7,"count":7,"up":0},{"race":"rampart","name":"unicorn","lvl":6,"count":3,"up":0}]},{"id":21,"x":4,"y":1,"type":0,"army":[{"race":"rampart","name":"gnom_2","lvl":2,"count":6,"up":1},{"race":"rampart","name":"unicorn","lvl":6,"count":6,"up":0},{"race":"rampart","name":"unicorn_2","lvl":6,"count":5,"up":1},{"race":"rampart","name":"pegas","lvl":4,"count":5,"up":0},{"race":"rampart","name":"elf_2","lvl":3,"count":3,"up":1},{"race":"rampart","name":"green_dragon_2","lvl":7,"count":1,"up":1},{"race":"rampart","name":"dendroid","lvl":5,"count":1,"up":0}]},{"id":22,"x":4,"y":2,"type":2,"army":[{"race":"rampart","name":"kentavr","lvl":1,"count":6,"up":0},{"race":"rampart","name":"elf_2","lvl":3,"count":5,"up":1},{"race":"rampart","name":"dendroid_2","lvl":5,"count":6,"up":1},{"race":"rampart","name":"unicorn","lvl":6,"count":5,"up":0},{"race":"rampart","name":"green_dragon","lvl":7,"count":10,"up":0},{"race":"rampart","name":"gnom","lvl":2,"count":5,"up":0}],"sector":{"parent":"region","class":"mine","type":"mercury","lvl":5,"x":4,"y":2,"upgrade":{"is":false,"date":0,"bonus":0},"work":{"is":false,"date":0,"bonus":0,"addValue":5}}},{"id":23,"x":4,"y":3,"type":0,"army":[{"race":"rampart","name":"green_dragon","lvl":7,"count":12,"up":0},{"race":"rampart","name":"dendroid_2","lvl":5,"count":9,"up":1},{"race":"rampart","name":"gnom_2","lvl":2,"count":10,"up":1},{"race":"rampart","name":"unicorn","lvl":6,"count":4,"up":0}]},{"id":24,"x":4,"y":4,"type":0,"army":[{"race":"rampart","name":"elf_2","lvl":3,"count":8,"up":1},{"race":"rampart","name":"kentavr","lvl":1,"count":5,"up":0},{"race":"rampart","name":"pegas","lvl":4,"count":3,"up":0},{"race":"rampart","name":"dendroid","lvl":5,"count":4,"up":0},{"race":"rampart","name":"elf","lvl":3,"count":6,"up":0},{"race":"rampart","name":"unicorn","lvl":6,"count":3,"up":0}]}]],"nickName":"admin","town":{"army":{"def":false,"units":[]},"class":"town","id":0,"name":"New Castle","storage":{"lvl":3,"class":"storage","type":"storage","upgrade":{"is":false,"date":1579554374446,"bonus":0},"work":{"is":false,"date":"2020-01-18T19:57:20.815Z","static":true},"maxValue":{"gold":200000,"baseResource":30,"unicResource":18},"sources":{"gold":{"lastCalc":1580237296635,"addValue":34000,"nowValue":200000,"maxValue":200000},"wood":{"lastCalc":1580237296635,"addValue":14,"nowValue":30,"maxValue":30},"ore":{"lastCalc":1580237296635,"addValue":14,"nowValue":30,"maxValue":30},"sulfur":{"lastCalc":1580237296635,"addValue":5,"nowValue":18,"maxValue":18},"crystal":{"lastCalc":1580237296635,"addValue":5,"nowValue":18,"maxValue":18},"mercury":{"lastCalc":1580237296635,"addValue":5,"nowValue":18,"maxValue":18},
"gem":{"lastCalc":1580237296635,"addValue":5,"nowValue":18,"maxValue":18}},"parent":"town","nextLvl":3},"hall":{"upgrade":{"is":false,"date":1579540983995,"bonus":0},"lvl":2,"class":"hall","parent":"town","type":"hall","work":{"is":false,"date":"2020-01-18T19:57:20.816Z","static":true},"nextLvl":2},"fort":{"upgrade":{"is":false,"date":0,"bonus":0},"lvl":1,"class":"fort","parent":"town","type":"fort","work":{"is":false,"date":"2020-01-18T19:57:20.816Z","static":true},"nextLvl":1},"guild":{"upgrade":{"is":false,"date":0,"bonus":0},"lvl":2,"class":"guild","parent":"town","type":"guild","work":{"is":false,"date":"2020-01-18T19:57:20.816Z","static":true},"nextLvl":2},"market":{"upgrade":{"is":false,"date":0,"bonus":0},"lvl":1,"class":"market","parent":"town","type":"market","work":{"is":false,"date":"2020-01-18T19:57:20.816Z","static":true},"nextLvl":1},"tavern":{"upgrade":{"is":false,"date":0,"bonus":0},"lvl":1,"class":"tavern","parent":"town","type":"tavern","work":{"is":false,"date":"2020-01-18T19:57:20.816Z","static":true},"nextLvl":1},"lvl":0,"race":0,"barraks_1":{"upgrade":{"is":false,"date":1579807851843,"bonus":0},"lvl":2,"class":"barraks","parent":"town","type":"barraks_1","work":{"is":true,"date":"2020-01-18T19:57:20.816Z","bonus":0,"addValue":12,"lastCalc":1580237289123,"nowValue":5629.40093333789,"static":false},"nextLvl":2},"barraks_2":{"upgrade":{"is":false,"date":1579379152414,"bonus":0},"lvl":1,"class":"barraks","parent":"town","type":"barraks_2","work":{"is":true,"date":"2020-01-18T19:57:20.816Z","bonus":0,"addValue":10,"lastCalc":1580237289123,"nowValue":4762.388494444756,"static":false},"nextLvl":1},"barraks_3":{"upgrade":{"is":false,"date":1579379149726,"bonus":0},"lvl":1,"class":"barraks","parent":"town","type":"barraks_3","work":{"is":true,"date":"2020-01-18T19:57:20.816Z","bonus":0,"addValue":8,"lastCalc":1580237289123,"nowValue":3787.9107999995736,"static":false},"nextLvl":1},"barraks_4":{"upgrade":{"is":false,"date":1579379195535,"bonus":0},"lvl":1,"class":"barraks","parent":"town","type":"barraks_4","work":{"is":true,"date":"2020-01-18T19:57:20.816Z","bonus":0,"addValue":6,"lastCalc":1580237289123,"nowValue":2856.2997666690785,"static":false},"nextLvl":1},"barraks_5":{"upgrade":{"is":false,"date":1579379973717,"bonus":0},"lvl":1,"class":"barraks","parent":"town","type":"barraks_5","work":{"is":true,"date":"2020-01-18T19:57:20.816Z","bonus":0,"addValue":4,"lastCalc":1580237289123,"nowValue":1898.133008888677,"static":false},"nextLvl":1},"barraks_6":{"upgrade":{"is":false,"date":1579379441764,"bonus":0},"lvl":1,"class":"barraks","parent":"town","type":"barraks_6","work":{"is":true,"date":"2020-01-18T19:57:20.816Z","bonus":0,"addValue":2,"lastCalc":1580237289123,"nowValue":949.1554611110038,"static":false},"nextLvl":1},"barraks_7":{"upgrade":{"is":false,"date":1579378821410,"bonus":0},"lvl":1,"class":"barraks","parent":"town","type":"barraks_7","work":{"is":true,"date":"2020-01-18T19:57:20.816Z","bonus":0,"addValue":1,"lastCalc":1580237289123,"nowValue":468.92229999994623,"static":false},"nextLvl":1}},"userId":"5e236315c57dfc19c04df8c8","heroes":["5e236320c57dfc19c04df8ca"]}]`;
    const store = new Vuex.Store({
      state: {
        count: 0,
        data: []
      },
      mutations: {
        increment(state) {
          state.count++;
        },
        set_data(state, payload) {
          state.data = payload;
        }
      },
      actions: {
        increment(context) {
          setInterval(() => {
            context.commit("increment");
            const newData = JSON.parse(data);
            context.commit("set_data", newData);
          }, 500);
        }
      }
    });

    var app = new Vue({
      store,
      el: "#app",
      template: `
          <div>{{count}}</div>
      `,
      data() {
        return {
          count: 0,
        };
      },
      created() {
        this.$store.dispatch("increment");
      },
      watch: {
        "$store.state.data": {
          deep: true,
          handler() {
            this.count = this.$store.state.count;
          }
        }
      }
    });
  </script>
</html>
